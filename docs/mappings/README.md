---
description: >-
  Mappings describe how Substate events and transactions should be handled by
  Hydra processor
---

# Mappings

A mapping file is a standalone typescript module defining how the Substrate events of interest should be handled by the Hydra indexer.

The event handlers \(aka _mappings_\) should be defined in the manifest file:

```yaml
mappings:
  eventHandlers:
    - event: balances.Transfer 
      handler: balancesTransfer(DatabaseManager, Balances.TransferEvent)
  extrinsicHandlers:
    # infer defaults
    - extrinsic: timestamp.set 
      handler: timestampCall(DatabaseManager, Timestamp.SetCall)
```

Each handler may have an arbitrary number of arguments, and at most one argument of type `DatabaseManager` and `SubstrateEvent`

Let us look at the sample mapping generated by the scaffolder

```typescript
import { DatabaseManager } from '@dzlzv/hydra-db-utils'
import { Transfer } from '../generated/graphql-server/src/modules/transfer/transfer.model'
import { BlockTimestamp } from '../generated/graphql-server/src/modules/block-timestamp/block-timestamp.model'

// run 'NODE_URL=<RPC_ENDPOINT> EVENTS=<comma separated list of events> yarn codegen:mappings-types'
// to genenerate typescript classes for events, such as Balances.TransferEvent
import { Balances, Timestamp } from './generated/types'
import BN from 'bn.js'

const start = Date.now()
let total = 0

export async function balancesTransfer(
  db: DatabaseManager,
  event: Balances.TransferEvent
) {
  const transfer = new Transfer()
  transfer.from = Buffer.from(event.data.accountIds[0].toHex())
  transfer.to = Buffer.from(event.data.accountIds[1].toHex())
  transfer.value = event.data.balance.toBn()
  transfer.block = event.ctx.blockNumber
  transfer.comment = `Transferred ${transfer.value} from ${transfer.from} to ${transfer.to}`
  transfer.insertedAt = new Date()
  await db.save<Transfer>(transfer)
}

export async function timestampCall(
  db: DatabaseManager,
  call: Timestamp.SetCall
) {
  const block = new BlockTimestamp()
  block.timestamp = call.args.now.toBn()
  block.blockNumber = new BN(call.ctx.blockNumber)
  console.log(`New block ${block.blockNumber} at ${block.timestamp}`)

  await db.save<BlockTimestamp>(block)
}
```

Note that required entity classes are exported from

```text
../generated/graphql-server/src/modules/<entity type>/<entity type>
```

and this is where all the auto-generated classes live by default.

Note how the event handler uses an argument of type `Balances.TransferEvent` generated by the `typegen` tool. Similarly, the extrinsic handler `timestampCall` uses the type `Timestamp.SetCall`

All the events and extrinsics for which we need the generate the types, should be defined in the typegen section like below.

```yaml
typegen:
  metadata:
    source: wss://rpc.polkadot.io
    blockHash: '0xab5c9230a7dde8bb90a6728ba4a0165423294dac14336b1443f865b796ff682c'
  events:
    - balances.Transfer
  calls:
    - timestamp.set
  outDir: ./mappings/generated/types
```

